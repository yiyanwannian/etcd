@startuml etcd-deployment-operations-architecture
!theme plain
title etcd éƒ¨ç½²æ¶æ„ä¸è¿ç»´è®¾è®¡

' ===== é›†ç¾¤éƒ¨ç½²æ¶æ„ =====
package "é›†ç¾¤éƒ¨ç½²æ¶æ„ Cluster Deployment Architecture" {
  
  ' å¤šæ•°æ®ä¸­å¿ƒéƒ¨ç½²
  package "æ•°æ®ä¸­å¿ƒ A Data Center A" <<Cloud>> {
    node "etcd-1" as ETCD1 {
      [etcd process] as ETCD_PROC1
      [data dir] as DATA1
      [wal dir] as WAL1
      database "BoltDB" as DB1
    }
    
    node "etcd-2" as ETCD2 {
      [etcd process] as ETCD_PROC2
      [data dir] as DATA2
      [wal dir] as WAL2
      database "BoltDB" as DB2
    }
  }
  
  package "æ•°æ®ä¸­å¿ƒ B Data Center B" <<Cloud>> {
    node "etcd-3" as ETCD3 {
      [etcd process] as ETCD_PROC3
      [data dir] as DATA3
      [wal dir] as WAL3
      database "BoltDB" as DB3
    }
    
    node "etcd-4" as ETCD4 {
      [etcd process] as ETCD_PROC4
      [data dir] as DATA4
      [wal dir] as WAL4
      database "BoltDB" as DB4
    }
  }
  
  package "æ•°æ®ä¸­å¿ƒ C Data Center C" <<Cloud>> {
    node "etcd-5" as ETCD5 {
      [etcd process] as ETCD_PROC5
      [data dir] as DATA5
      [wal dir] as WAL5
      database "BoltDB" as DB5
    }
  }
  
  ' Raft é›†ç¾¤è¿æ¥
  ETCD_PROC1 <--> ETCD_PROC2 : Raft Peer
  ETCD_PROC1 <--> ETCD_PROC3 : Raft Peer
  ETCD_PROC1 <--> ETCD_PROC4 : Raft Peer
  ETCD_PROC1 <--> ETCD_PROC5 : Raft Peer
  ETCD_PROC2 <--> ETCD_PROC3 : Raft Peer
  ETCD_PROC2 <--> ETCD_PROC4 : Raft Peer
  ETCD_PROC2 <--> ETCD_PROC5 : Raft Peer
  ETCD_PROC3 <--> ETCD_PROC4 : Raft Peer
  ETCD_PROC3 <--> ETCD_PROC5 : Raft Peer
  ETCD_PROC4 <--> ETCD_PROC5 : Raft Peer
  
  note as CLUSTER_NOTE
    é›†ç¾¤éƒ¨ç½²è®¾è®¡åŸåˆ™:
    
    1. å¥‡æ•°èŠ‚ç‚¹éƒ¨ç½²
       - é¿å…è„‘è£‚é—®é¢˜
       - ä¿è¯å¤šæ•°æ´¾é€‰ä¸¾
    
    2. è·¨æ•°æ®ä¸­å¿ƒåˆ†å¸ƒ
       - æé«˜å¯ç”¨æ€§
       - å®¹å¿æ•°æ®ä¸­å¿ƒæ•…éšœ
    
    3. ç½‘ç»œå»¶è¿Ÿè€ƒè™‘
       - åŒåŸéƒ¨ç½²ä¼˜å…ˆ
       - æ§åˆ¶ç½‘ç»œå»¶è¿Ÿ < 10ms
    
    4. ç¡¬ä»¶é…ç½®
       - SSD å­˜å‚¨
       - å……è¶³å†…å­˜
       - ä¸“ç”¨ç½‘ç»œ
  end note
}

' ===== è´Ÿè½½å‡è¡¡ä¸ä»£ç† =====
package "è´Ÿè½½å‡è¡¡ Load Balancing" {
  
  cloud "å®¢æˆ·ç«¯åº”ç”¨ Client Applications" as CLIENTS
  
  node "è´Ÿè½½å‡è¡¡å™¨ Load Balancer" as LB {
    [HAProxy/Nginx] as PROXY
    [å¥åº·æ£€æŸ¥] as HEALTH_CHECK
    [æ•…éšœè½¬ç§»] as FAILOVER
  }
  
  node "etcd ä»£ç† etcd Proxy" as ETCD_PROXY {
    [grpc-proxy] as GRPC_PROXY
    [è¿æ¥æ± ] as CONN_POOL
    [è¯·æ±‚è·¯ç”±] as ROUTING
  }
  
  CLIENTS --> LB : å®¢æˆ·ç«¯è¯·æ±‚
  LB --> ETCD_PROXY : ä»£ç†è½¬å‘
  ETCD_PROXY --> ETCD_PROC1 : è¯»å†™åˆ†ç¦»
  ETCD_PROXY --> ETCD_PROC2 : åªè¯»è¯·æ±‚
  ETCD_PROXY --> ETCD_PROC3 : åªè¯»è¯·æ±‚
  
  note right of LB
    è´Ÿè½½å‡è¡¡ç­–ç•¥:
    
    1. è¯»å†™åˆ†ç¦»
       - å†™è¯·æ±‚è·¯ç”±åˆ° Leader
       - è¯»è¯·æ±‚åˆ†å‘åˆ°æ‰€æœ‰èŠ‚ç‚¹
    
    2. å¥åº·æ£€æŸ¥
       - å®šæœŸæ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€
       - è‡ªåŠ¨æ‘˜é™¤æ•…éšœèŠ‚ç‚¹
    
    3. è¿æ¥ç®¡ç†
       - è¿æ¥æ± å¤ç”¨
       - é•¿è¿æ¥ä¿æŒ
    
    4. æ•…éšœè½¬ç§»
       - å¿«é€Ÿæ•…éšœæ£€æµ‹
       - è‡ªåŠ¨åˆ‡æ¢å¤‡ç”¨èŠ‚ç‚¹
  end note
}

' ===== ç›‘æ§ä¸å‘Šè­¦ =====
package "ç›‘æ§å‘Šè­¦ Monitoring & Alerting" {
  
  node "ç›‘æ§ç³»ç»Ÿ Monitoring System" as MONITORING {
    [Prometheus] as PROMETHEUS
    [Grafana] as GRAFANA
    [AlertManager] as ALERT_MGR
  }
  
  node "æ—¥å¿—ç³»ç»Ÿ Logging System" as LOGGING {
    [Fluentd/Logstash] as LOG_COLLECTOR
    [Elasticsearch] as ES
    [Kibana] as KIBANA
  }
  
  node "é“¾è·¯è¿½è¸ª Distributed Tracing" as TRACING {
    [Jaeger/Zipkin] as TRACER
    [OpenTelemetry] as OTEL
  }
  
  ' ç›‘æ§æ•°æ®æ”¶é›†
  ETCD_PROC1 --> PROMETHEUS : /metrics
  ETCD_PROC2 --> PROMETHEUS : /metrics
  ETCD_PROC3 --> PROMETHEUS : /metrics
  ETCD_PROC4 --> PROMETHEUS : /metrics
  ETCD_PROC5 --> PROMETHEUS : /metrics
  
  ' æ—¥å¿—æ”¶é›†
  ETCD_PROC1 --> LOG_COLLECTOR : æ—¥å¿—
  ETCD_PROC2 --> LOG_COLLECTOR : æ—¥å¿—
  ETCD_PROC3 --> LOG_COLLECTOR : æ—¥å¿—
  
  ' å¯è§†åŒ–
  PROMETHEUS --> GRAFANA : æŒ‡æ ‡æŸ¥è¯¢
  LOG_COLLECTOR --> ES : æ—¥å¿—å­˜å‚¨
  ES --> KIBANA : æ—¥å¿—æŸ¥è¯¢
  
  ' å‘Šè­¦
  PROMETHEUS --> ALERT_MGR : å‘Šè­¦è§„åˆ™
  
  note right of MONITORING
    ç›‘æ§æŒ‡æ ‡ä½“ç³»:
    
    ğŸ“Š æ€§èƒ½æŒ‡æ ‡:
    - è¯·æ±‚å»¶è¿Ÿ (P50, P95, P99)
    - è¯·æ±‚ååé‡ (QPS)
    - é”™è¯¯ç‡ç»Ÿè®¡
    
    ğŸ”§ ç³»ç»ŸæŒ‡æ ‡:
    - CPUã€å†…å­˜ä½¿ç”¨ç‡
    - ç£ç›˜ I/O å’Œç©ºé—´
    - ç½‘ç»œæµé‡å’Œå»¶è¿Ÿ
    
    ğŸ¯ ä¸šåŠ¡æŒ‡æ ‡:
    - Raft çŠ¶æ€å’Œä»»æœŸ
    - é›†ç¾¤æˆå‘˜çŠ¶æ€
    - æ•°æ®åº“å¤§å°å’Œå‹ç¼©
    
    âš ï¸ å‘Šè­¦è§„åˆ™:
    - èŠ‚ç‚¹ä¸å¯ç”¨
    - æ€§èƒ½å¼‚å¸¸
    - å­˜å‚¨ç©ºé—´ä¸è¶³
  end note
}

' ===== å¤‡ä»½ä¸æ¢å¤ =====
package "å¤‡ä»½æ¢å¤ Backup & Recovery" {
  
  node "å¤‡ä»½ç³»ç»Ÿ Backup System" as BACKUP {
    [å®šæ—¶å¤‡ä»½] as SCHEDULED_BACKUP
    [å¢é‡å¤‡ä»½] as INCREMENTAL_BACKUP
    [å¿«ç…§ç®¡ç†] as SNAPSHOT_MGR
  }
  
  node "å­˜å‚¨ç³»ç»Ÿ Storage System" as STORAGE {
    [å¯¹è±¡å­˜å‚¨ S3/OSS] as OBJECT_STORAGE
    [æœ¬åœ°å­˜å‚¨] as LOCAL_STORAGE
    [ç½‘ç»œå­˜å‚¨ NFS] as NETWORK_STORAGE
  }
  
  node "æ¢å¤ç³»ç»Ÿ Recovery System" as RECOVERY {
    [å¿«ç…§æ¢å¤] as SNAPSHOT_RESTORE
    [æ•°æ®éªŒè¯] as DATA_VALIDATION
    [é›†ç¾¤é‡å»º] as CLUSTER_REBUILD
  }
  
  ' å¤‡ä»½æµç¨‹
  ETCD_PROC1 --> SCHEDULED_BACKUP : etcdctl snapshot save
  SCHEDULED_BACKUP --> OBJECT_STORAGE : ä¸Šä¼ å¤‡ä»½
  
  ' æ¢å¤æµç¨‹
  OBJECT_STORAGE --> SNAPSHOT_RESTORE : ä¸‹è½½å¤‡ä»½
  SNAPSHOT_RESTORE --> ETCD_PROC1 : etcdutl snapshot restore
  
  note right of BACKUP
    å¤‡ä»½æ¢å¤ç­–ç•¥:
    
    ğŸ”„ å¤‡ä»½ç­–ç•¥:
    - å…¨é‡å¿«ç…§å¤‡ä»½
    - WAL å¢é‡å¤‡ä»½
    - å¤šåœ°åŸŸå­˜å‚¨
    
    â° å¤‡ä»½é¢‘ç‡:
    - æ¯æ—¥å…¨é‡å¤‡ä»½
    - æ¯å°æ—¶å¢é‡å¤‡ä»½
    - å…³é”®æ“ä½œå‰å¤‡ä»½
    
    ğŸ”§ æ¢å¤æµç¨‹:
    - æ•°æ®ä¸€è‡´æ€§éªŒè¯
    - é›†ç¾¤æˆå‘˜é‡å»º
    - æœåŠ¡é€æ­¥å¯åŠ¨
    
    âœ… éªŒè¯æœºåˆ¶:
    - å¤‡ä»½å®Œæ•´æ€§æ£€æŸ¥
    - æ¢å¤æ•°æ®éªŒè¯
    - åŠŸèƒ½æµ‹è¯•éªŒè¯
  end note
}

' ===== å®‰å…¨æ¶æ„ =====
package "å®‰å…¨æ¶æ„ Security Architecture" {
  
  node "ç½‘ç»œå®‰å…¨ Network Security" as NETWORK_SEC {
    [TLS åŠ å¯†] as TLS
    [é˜²ç«å¢™] as FIREWALL
    [VPN éš§é“] as VPN
  }
  
  node "è®¤è¯æˆæƒ Authentication & Authorization" as AUTH_SEC {
    [RBAC æƒé™] as RBAC
    [JWT ä»¤ç‰Œ] as JWT
    [è¯ä¹¦ç®¡ç†] as CERT_MGR
  }
  
  node "å®¡è®¡æ—¥å¿— Audit Logging" as AUDIT {
    [æ“ä½œå®¡è®¡] as OP_AUDIT
    [è®¿é—®æ—¥å¿—] as ACCESS_LOG
    [å®‰å…¨äº‹ä»¶] as SEC_EVENT
  }
  
  ' å®‰å…¨è¿æ¥
  CLIENTS -.-> TLS : HTTPS/gRPC-TLS
  TLS -.-> ETCD_PROC1 : åŠ å¯†é€šä¿¡
  
  note right of NETWORK_SEC
    å®‰å…¨è®¾è®¡åŸåˆ™:
    
    ğŸ” ä¼ è¾“å®‰å…¨:
    - TLS 1.3 åŠ å¯†é€šä¿¡
    - åŒå‘è¯ä¹¦è®¤è¯
    - è¯ä¹¦è‡ªåŠ¨è½®æ¢
    
    ğŸ›¡ï¸ è®¿é—®æ§åˆ¶:
    - RBAC ç»†ç²’åº¦æƒé™
    - æœ€å°æƒé™åŸåˆ™
    - å®šæœŸæƒé™å®¡æŸ¥
    
    ğŸ“ å®¡è®¡è¿½è¸ª:
    - å®Œæ•´æ“ä½œæ—¥å¿—
    - å®‰å…¨äº‹ä»¶ç›‘æ§
    - åˆè§„æ€§æŠ¥å‘Š
    
    ğŸ”§ å®‰å…¨è¿ç»´:
    - å®šæœŸå®‰å…¨æ‰«æ
    - æ¼æ´ä¿®å¤ç®¡ç†
    - åº”æ€¥å“åº”é¢„æ¡ˆ
  end note
}

' ===== å®¹é‡è§„åˆ’ =====
package "å®¹é‡è§„åˆ’ Capacity Planning" {
  
  class "æ€§èƒ½åŸºå‡† Performance Baseline" as PERF_BASELINE {
    +è¯»å– QPS: 100,000+
    +å†™å…¥ QPS: 10,000+
    +å»¶è¿Ÿ P99: < 10ms
    +å­˜å‚¨å®¹é‡: 8GB é»˜è®¤
    --
    åŸºäºç¡¬ä»¶é…ç½®å’Œè´Ÿè½½æ¨¡å¼
  }
  
  class "æ‰©å®¹ç­–ç•¥ Scaling Strategy" as SCALING_STRATEGY {
    +å‚ç›´æ‰©å®¹: å¢åŠ ç¡¬ä»¶èµ„æº
    +æ°´å¹³æ‰©å®¹: å¢åŠ é›†ç¾¤èŠ‚ç‚¹
    +è¯»å†™åˆ†ç¦»: åªè¯»èŠ‚ç‚¹æ‰©å±•
    +åˆ†ç‰‡ç­–ç•¥: æ•°æ®åˆ†åŒº
    --
    æ ¹æ®ä¸šåŠ¡å¢é•¿é¢„æµ‹
  }
  
  class "èµ„æºç›‘æ§ Resource Monitoring" as RESOURCE_MON {
    +CPU ä½¿ç”¨ç‡ç›‘æ§
    +å†…å­˜ä½¿ç”¨ç‡ç›‘æ§
    +ç£ç›˜ç©ºé—´ç›‘æ§
    +ç½‘ç»œå¸¦å®½ç›‘æ§
    --
    å®æ—¶èµ„æºä½¿ç”¨æƒ…å†µ
  }
  
  note as CAPACITY_NOTE
    å®¹é‡è§„åˆ’è€ƒè™‘å› ç´ :
    
    ğŸ“ˆ ä¸šåŠ¡å¢é•¿:
    - ç”¨æˆ·æ•°é‡å¢é•¿
    - æ•°æ®é‡å¢é•¿
    - è¯·æ±‚é‡å¢é•¿
    
    ğŸ¯ æ€§èƒ½ç›®æ ‡:
    - å“åº”æ—¶é—´è¦æ±‚
    - ååé‡è¦æ±‚
    - å¯ç”¨æ€§è¦æ±‚
    
    ğŸ’° æˆæœ¬æ§åˆ¶:
    - ç¡¬ä»¶æˆæœ¬
    - è¿ç»´æˆæœ¬
    - äº‘æœåŠ¡æˆæœ¬
    
    ğŸ”® æœªæ¥è§„åˆ’:
    - 3-5 å¹´å®¹é‡é¢„æµ‹
    - æŠ€æœ¯æ¼”è¿›è€ƒè™‘
    - ä¸šåŠ¡å‘å±•è§„åˆ’
  end note
}

@enduml
